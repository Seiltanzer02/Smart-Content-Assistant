# Content Manager

Сервис для управления контентом и автоматизации создания постов.

## Обновление системы подписок

В проект были внесены следующие улучшения:

### Бэкенд
- Создан новый сервис `SupabaseSubscriptionService` для работы с подписками
- Исправлены ошибки в проверке лимитов использования
- Добавлены эндпоинты для проверки статуса подписки и активации подписки
- Реализован механизм сброса счетчиков использования ежемесячно
- Обновлены эндпоинты анализа и генерации постов для корректной работы с подписками
- Добавлен глобальный обработчик ошибок
- Созданы новые миграции для базы данных

### Фронтенд
- Создан компонент для отображения информации о подписке
- Обновлен виджет подписки с использованием Material UI
- Разработаны утилиты для работы с API
- Создана страница настроек с информацией о подписке

### Миграции
- 004_add_subscription_reset_date.sql: добавляет поле reset_at в таблицу user_usage_stats
- 005_add_payments_table.sql: создаёт таблицу для учёта платежей
- 006_create_missing_tables.py: универсальный скрипт для создания отсутствующих таблиц

## Требования

- Python 3.8+
- Node.js 14+
- Supabase аккаунт

## Установка и запуск

### Бэкенд
```
cd backend
pip install -r requirements.txt
python main.py
```

### Фронтенд
```
cd frontend
npm install
npm start
```

## Переменные окружения

Создайте файл `.env` в корне проекта со следующими переменными:

```
SUPABASE_URL=ваш_url
SUPABASE_KEY=ваш_ключ
TELEGRAM_BOT_TOKEN=ваш_токен
OPENAI_API_KEY=ваш_ключ
```

# Менеджер контента для Telegram

## Партнерская программа

В системе реализована партнерская программа с использованием Telegram Stars. Партнеры могут получать уникальные реферальные ссылки и отслеживать привлеченных пользователей.

### Основные возможности:

1. Получение уникальной партнерской ссылки через API Telegram
2. Отслеживание привлеченных пользователей
3. Статистика по реферальной программе

### API эндпоинты:

- **GET /partner/link/{user_id}** - получить партнерскую ссылку для пользователя
- **GET /partner/stats/{user_id}** - получить статистику по реферальной программе
- **POST /partner/track** - отследить реферальную активность

### Требования:

Для работы с партнерской программой необходимо установить дополнительные переменные окружения:
- `TELEGRAM_API_ID` - API ID из my.telegram.org
- `TELEGRAM_API_HASH` - API Hash из my.telegram.org

## Установка и настройка

```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск приложения
uvicorn main_fixed:app --reload
```

## Переменные окружения

Создайте файл `.env` в корне проекта:

```
TELEGRAM_BOT_TOKEN=ваш_токен_бота
TELEGRAM_BOT_USERNAME=@YourBot
DATABASE_URL=ваш_url_базы_данных
TELEGRAM_API_ID=ваш_api_id
TELEGRAM_API_HASH=ваш_api_hash
``` 